<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Criação de Lembrete</title>
  <link rel="stylesheet" href="./assets/css/criacaoLembrete.css" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
  />
  <style>
    .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
      color: white;
      background: rgba(255, 255, 255, 0.2);
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 0.9em;
    }

    .user-info .user-name {
      font-weight: bold;
    }

    .logout-btn {
      background: #d32f2f;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 15px;
      cursor: pointer;
      font-size: 0.8em;
      transition: background-color 0.3s;
    }

    .logout-btn:hover {
      background: #b71c1c;
    }
  </style>
</head>
<body>
  <header>
    <div class="img-logo">
      <a href="/codigo/public/index.html">
        <img src="/docs/images/logo.remed.jpg" alt="Logotipo da Remedicy" />
      </a>
      <h1 class="text-logo">Remedicy</h1>
    </div>
    <nav class="infos-mais">
      <div id="user-status">
        <!-- Será preenchido via JavaScript -->
      </div>
      <a class="botao-link" href="/codigo/public/about.html">Sobre nós</a>
      <a class="botao-link" href="/codigo/public/ajuda.html">Suporte</a>
    </nav>
  </header>

  <main>
    <form class="form-container" method="POST">
      <div class="form-content">
        <div class="form-left">
          <input
            type="text"
            name="nome_remedio"
            placeholder="nome do remédio*"
            required
          />
          <input type="text" name="descricao" placeholder="descrição" />
          <input type="text" name="como_tomar" placeholder="Como tomar" />
          <select name="pessoa" required>
            <option value="">Para quem é o remédio?*</option>
            <option value="eu">Para mim</option>
            <option value="dependente">Para meu dependente</option>
          </select>
          <input
            type="text"
            name="nome_dependente"
            placeholder="Nome do dependente"
            style="display: none"
          />
          <input type="time" name="horario" placeholder="Horário*" required />
          <input type="date" id="data_calendario" />
          <!-- placeholder não funciona em input type=date -->
        </div>

        <div class="form-right">
          <div id="calendario-container">
            <div id="calendario-header">
              <button type="button" id="mes-anterior">&lt;</button>
              <span id="mes-ano"></span>
              <button type="button" id="mes-posterior">&gt;</button>
            </div>
            <div id="dias-semana">
              <div>D</div>
              <div>S</div>
              <div>T</div>
              <div>Q</div>
              <div>Q</div>
              <div>S</div>
              <div>S</div>
            </div>
            <div id="dias-calendario"></div>
          </div>
        </div>
      </div>

      <div class="form-footer">
        <button type="button" class="btn-voltar" onclick="history.back()">
          Voltar
        </button>
        <button type="submit" class="btn-salvar">Salvar</button>
      </div>
    </form>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const lembreteEditando = localStorage.getItem("lembreteEditando");

      if (lembreteEditando !== null) {
        const lembretes = JSON.parse(localStorage.getItem("lembretes")) || [];
        const lembrete = lembretes[lembreteEditando];
        if (lembrete) {
          document.querySelector('[name="nome_remedio"]').value = lembrete.nome;
          document.querySelector('[name="descricao"]').value = lembrete.descricao;
          document.querySelector('[name="como_tomar"]').value = lembrete.comoTomar;
          document.querySelector('[name="horario"]').value = lembrete.horario;
          document.getElementById("data_calendario").value =
            lembrete.dataCalendario || "";
          document.querySelector('[name="pessoa"]').value = lembrete.pessoa || "";
          document.querySelector('[name="nome_dependente"]').value =
            lembrete.nomeDependente || "";

          if (lembrete.pessoa === "dependente") {
            document.querySelector('[name="nome_dependente"]').style.display = "block";
            document.querySelector('[name="nome_dependente"]').required = true;
          }
        }
      } else {
        document.querySelector('[name="nome_remedio"]').value = "";
        document.querySelector('[name="descricao"]').value = "";
        document.querySelector('[name="como_tomar"]').value = "";
        document.querySelector('[name="horario"]').value = "";
        document.getElementById("data_calendario").value = "";
      }
    });

    document
      .querySelector(".form-container")
      .addEventListener("submit", function (event) {
        event.preventDefault();

        const nome = document.querySelector('[name="nome_remedio"]').value.trim();
        const descricao = document.querySelector('[name="descricao"]').value.trim();
        const comoTomar = document.querySelector('[name="como_tomar"]').value.trim();
        const horario = document.querySelector('[name="horario"]').value.trim();
        const dataCalendario = document.getElementById("data_calendario").value;

        const pessoa = document.querySelector('[name="pessoa"]').value;
        const nomeDependente = document
          .querySelector('[name="nome_dependente"]')
          .value.trim();

        if (!nome || !horario || !dataCalendario || !pessoa) {
          alert(
            "Preencha os campos obrigatórios: nome do remédio, horário, data e para quem é o remédio."
          );
          return;
        }

        if (pessoa === "dependente" && !nomeDependente) {
          alert("Por favor, informe o nome do dependente.");
          return;
        }

        const lembrete = {
          nome,
          descricao,
          comoTomar,
          horario,
          diasSelecionados: "",
          dataCalendario,
          pessoa,
          nomeDependente: pessoa === "dependente" ? nomeDependente : "",
        };

        let lembretes = JSON.parse(localStorage.getItem("lembretes")) || [];
        const editando = localStorage.getItem("lembreteEditando");

        if (editando !== null) {
          lembretes[editando] = lembrete;
          localStorage.removeItem("lembreteEditando");
        } else {
          lembretes.push(lembrete);
        }

        localStorage.setItem("lembretes", JSON.stringify(lembretes));
        window.location.href = "listaLembretes.html";
      });

    const dataInput = document.getElementById("data_calendario");
    const mesAno = document.getElementById("mes-ano");
    const diasCalendario = document.getElementById("dias-calendario");
    const btnAnterior = document.getElementById("mes-anterior");
    const btnPosterior = document.getElementById("mes-posterior");

    let dataAtual = new Date();

    function renderizarCalendario(data) {
      const ano = data.getFullYear();
      const mes = data.getMonth();
      const primeiroDia = new Date(ano, mes, 1).getDay();
      const ultimoDia = new Date(ano, mes + 1, 0).getDate();

      mesAno.textContent = data.toLocaleString("pt-BR", {
        month: "long",
        year: "numeric",
      });

      diasCalendario.innerHTML = "";

      for (let i = 0; i < primeiroDia; i++) {
        diasCalendario.innerHTML += `<div class="vazio"></div>`;
      }

      for (let dia = 1; dia <= ultimoDia; dia++) {
        const dataCompleta = new Date(ano, mes, dia);
        const dataFormatada = dataCompleta.toISOString().split("T")[0];
        diasCalendario.innerHTML += `<div class="dia" data-data="${dataFormatada}">${dia}</div>`;
      }

      document.querySelectorAll(".dia").forEach((el) => {
        el.addEventListener("click", () => {
          const dataSelecionada = el.getAttribute("data-data");
          dataInput.value = dataSelecionada;
        });
      });
    }

    btnAnterior.addEventListener("click", () => {
      dataAtual.setMonth(dataAtual.getMonth() - 1);
      renderizarCalendario(dataAtual);
    });

    btnPosterior.addEventListener("click", () => {
      dataAtual.setMonth(dataAtual.getMonth() + 1);
      renderizarCalendario(dataAtual);
    });

    renderizarCalendario(dataAtual);

    document.querySelector('[name="pessoa"]').addEventListener("change", function () {
      const nomeDependenteField = document.querySelector('[name="nome_dependente"]');
      if (this.value === "dependente") {
        nomeDependenteField.style.display = "block";
        nomeDependenteField.required = true;
      } else {
        nomeDependenteField.style.display = "none";
        nomeDependenteField.required = false;
        nomeDependenteField.value = "";
      }
    });

    function atualizarStatusUsuario() {
      const script = document.createElement("script");
      script.src = "./assets/js/login.js";
      document.head.appendChild(script);

      script.onload = function () {
        const usuario = getCurrentUser();
        const userStatus = document.getElementById("user-status");

        if (usuario && usuario.nome) {
          userStatus.innerHTML = `
          <div class="user-info">
            <i class="fa-solid fa-user-circle"></i>
            <span class="user-name">${usuario.nome}</span>
            <button class="logout-btn" onclick="confirmarLogout()">
              <i class="fa-solid fa-sign-out-alt"></i> Sair
            </button>
          </div>
          `;
        } else {
          userStatus.innerHTML = `
          <a class="botao-link" href="/codigo/public/login.html">Login/Inscrição</a>
          `;
        }
      };
    }

    function confirmarLogout() {
      if (confirm("Tem certeza que deseja sair?")) {
        logoutUser();
      }
    }

    atualizarStatusUsuario();
  </script>

  <footer class="site-footer">
    <div class="footer-container">
      <div class="footer-column footer-about">
        <h4><i class="fa-solid fa-pills"></i> Remedicy</h4>
        <p>
          Simplificando o gerenciamento da sua saúde. Lembretes, calendário e
          mais em um só lugar.
        </p>
        <p>Projeto acadêmico da disciplina de Trabalho Interdisciplinar.</p>
      </div>

      <div class="footer-column footer-links-group">
        <h4><i class="fa-solid fa-link"></i> Links Rápidos</h4>
        <ul class="footer-links">
          <li><a href="/codigo/public/index.html">Página Inicial</a></li>
          <li><a href="/codigo/public/about.html">Sobre Nós</a></li>
          <li><a href="/codigo/public/listaLembretes.html">Meus Lembretes</a></li>
          <li><a href="/codigo/public/ajuda.html">Ajuda e FAQ</a></li>
        </ul>
      </div>

      <div class="footer-column footer-team">
        <h4><i class="fa-solid fa-users"></i> Equipe</h4>
        <ul class="footer-links">
          <li><a href="#">Cristiano Avelar</a></li>
          <li><a href="#">Davi Penna</a></li>
          <li><a href="#">Eduardo Borges</a></li>
          <li><a href="#">Henrique Cesar</a></li>
          <li><a href="#">Raphael Dantas</a></li>
        </ul>
      </div>

      <div class="footer-column footer-contact">
        <h4><i class="fa-solid fa-headset"></i> Contato</h4>
        <ul class="footer-links">
          <li><i class="fa-solid fa-envelope"></i> suporte@remedicy.com.br</li>
          <li><i class="fa-solid fa-phone"></i> (31) 98887-9261</li>
          <li><i class="fa-solid fa-map-marker-alt"></i> Contagem, MG - Brasil</li>
        </ul>
      </div>
    </div>

    <div class="footer-bottom">
      <p>Remedicy © 2025. Todos os direitos reservados.</p>
    </div>
  </footer>
</body>
</html>
